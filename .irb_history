baseline = User.count
User.count == baseline
User.count == baseline
User.order(created_at: :desc).limit(5).pluck(:id, :guest_uid, :auth_kind, :created_at)
User.delete_all
User.count
exit
User.find_by(guest_uid:eyJfcmmpbHMiOnsibWVzc2FnZSI6IklqUmxaR1V4WWpGakxUTTVNamt0TkdJMFl5MWhaV0kyTFRNeU1tTmpaVFpsTmpJd1pTST0iLCJleHAiOiIyMDI2LTA0LTEwVDA4OjAwOjA0LjM2NloiLCJwdXIiOiJjb29raWUuZ3Vlc3RfdWlkIn19--169ac89102700fa1e0a249724a42a3af7d068125)&.destroy!
uid = User.order(created_at: :desc).limit(1).pluck(:guest_uid).first
User.find_by(guest_uid: uid)&.destroy!
User.find_by(guest_uid:uid)
uid = 34cb9c13-9056-401a-8d52-cdbf85513b7f
uid=ae9966eb-85fa-4982-8ad9-e442ae31360c
uid ="ae9966eb-85fa-4982-8ad9-e442ae31360c"
User.exists?(guest_uid: uid)
User.find_by(guest_uid: uid)&.destroy!
User.exists?(guest_uid: uid)
user = "5dfa924a-bbb3-4828-b99b-66e78f775f91"
User.exists?(guest_uid: uid)
User.exists?(guest_uid: uid)
uid="5dfa924a-bbb3-4828-b99b-66e78f775f91"
User.exists?(guest_uid: uid)
User.find_by(guest_uid: uid)&.destroy!
User.exists?(guest_uid: uid)
User.exists?(guest_uid: uid)
User.find_by(guest_uid: uid).created_at
exit
<<<<<<< HEAD
=======
user = User.create!(guest_uid: SecureRandom.uuid, auth_kind: :guest, nickname: "もふもふ")
patch "/nickname", params: { user: { nickname: "ぽめまる" }, terms: "1" }
exit
User.count
user = User.last
user.nickname
docker compose exec web rails db:reset
docker compose exec web rails db:reset
User.count
exit
User.count
User.count
User.count
User.count
User.count
User.last.nickname
exit
>>>>>>> nrc_backup
conv = Conversation.find_by(code:"conv.greet.morning.breakfast")
conv.text
exit
conv = Conversation.find_by(code:"conv.greet.morning.breakfast")
conv.text
exit
u = User.last
coords = u.region_coords
service = Weather::FetchCurrentWeather.new(lat: coords[:lat], lon: coords[:lon])
result = service.send(:fetch_from_api)
result
exit
u = User.last
coords = u.region_coords
coords
service = Weather::FetchCurrentWeather.new(lat: coords[:lat], lon: coords[:lon])
result  = service.send(:fetch_from_api)
result
exit
u = User.last
coords  = u.region_coords
service = Weather::FetchCurrentWeather.new(lat: coords[:lat], lon: coords[:lon])
raw     = service.send(:fetch_from_api)
raw
raw.dig(:current, :weather_code)
result = service.call
result.slot
exit
Conversation
Conversation.find_by(code: "conv.greet.noon.lunch")
exit
Convasation.find_by(conv.greet.noon.lunch)
Conversation.find_by(conv.greet.noon.lunch)
Conversation.find_by(code: "conv.greet.noon.lunch")
exit
exit
ActiveRecord::Base.connection_db_config.database
exit
Conversation.defined_enums["time_slot"]
exit
exit
Conversation.where(kind: :talk).where(time_slot: [:late_night, :any]).count
exit
Conversation.where(kind: :talk)\
            .where(time_slot: [:late_night, :any])\
            .pluck(:code, :time_slot)
exit
user = User.first
Interaction.create!(\
  user: user,\
  kind: :snack,\
  snack_type: :cookie,\
  happened_at: Time.current\
)
Interaction.create!(\
  user: user,\
  kind: :toy,\
  happened_at: Time.current\
)
Interaction.last.snack?
Interaction.last.toy?
character = Character.first!
Interaction.create!(\
  user: user,\
  character: character,\
  kind: :snack,\
  snack_type: :cookie,\
  happened_at: Time.current\
)
Interaction.last.kind
exit
user = User.first
character = Character.first!
Interaction.create!(\
  user: user,\
  character: character,\
  kind: :snack,\
  snack_type: :cookie,\
  happened_at: Time.current\
)
exit
User.first
character = Character.first!
\
Interaction.create!(\
  user: user,\
  character: character,\
  kind: :snack,\
  snack_type: :cookie,\
  happened_at: Time.current\
)
user = User.first
character = Character.first!
Interaction.create!(\
  user: user,\
  character: character,\
  kind: :snack,\
  snack_type: :cookie,\
  happened_at: Time.current\
)
Interaction.last.snack?
Interaction.last.cookie?
Interaction.last.character
exit
exit
ActiveRecord::Base.connection_db_config.database
exit
c = Character.find_by(name: "ぽめまる")\
[c&.id, c&.name, c&.key]\
Rails.application.config_for(:expressions).keys\
Rails.application.config_for(:expressions)[c&.key.to_s]
docker compose exec web sh -lc "ls -l config | sed -n '1,120p'; echo '---'; ls -l config/expressions.yml || true; echo '---'; sed -n '1,120p' config/expressions.yml || true"
exit
c = Character.find_by!(name: "ぽめまる")\
c.key
c = Character.find_by!(name: "ぽめまる")\
exec
exit
Rails.application.config_for(:expressions).keys
exit
ActiveRecord::Base.connection.columns(:characters).map(&:name)
ActiveRecord::Base.connection.columns(:user_characters).map(&:name)
exit
Interaction.distinct.pluck(:kind)
exit
Interaction.distinct.pluck(:kind)
exit
require "mini_magick"\
MiniMagick::Image.create("png") { |f| f.write("") }
exit
d = current_user.mofu_diaries.order(created_at: :desc).first\
d.share_token
d = current_user.mofu_diaries.order(created_at: :desc).first
u = User.last
d = u.mofu_diaries.order(created_at: :desc).first
d.share_token
d = MofuDiary.order(created_at: :desc).first\
d
d.user_id\
d.share_token
exit
diary = User.last.mofu_diaries.last
diary = MofuDiary.last
diary.update!(weather_slot: :cloudy)
MofuDiary.defined_enums
exit
MofuDiary.defined_enums
diary = MofuDiary.last\
diary.update!(weather_slot: :cloudy)\
diary.weather_slot
diary = MofuDiary.last\
diary.update!(weather_slot: :rain)
diary = MofuDiary.find(8)
diary.update!(weather_slot: :rain)
diary.update!(weather_slot: :snow)
exit
today = Time.zone.today\
diary = current_user.mofu_diaries.find_by(date: today)\
diary.destroy
diary = MofuDiary.find(8)\
diary.destroy
exit
user = User.last\
today = Time.zone.today\
user.mofu_diaries.where(date: today).destroy_all
user  = User.last\
date  = Time.zone.today\
\
cases = [\
  {name: "rest",              snack: 0, talk: 0},\
  {name: "snack_only_1",      snack: 1, talk: 0},\
  {name: "snack_only_2",      snack: 2, talk: 0},\
  {name: "snack_only_3",      snack: 3, talk: 0},\
  {name: "talk_only_1",       snack: 0, talk: 1},\
  {name: "talk_only_4",       snack: 0, talk: 4},\
  {name: "talk_only_5",       snack: 0, talk: 5},\
  {name: "both_light_min",    snack: 1, talk: 1}, # 両方ライト（最低条件）\
  {name: "both_light_max",    snack: 2, talk: 4}, # 両方ライト（上限側）\
  {name: "both_heavy_edge",   snack: 3, talk: 5}, # 両方ヘビーの境界\
  {name: "both_heavy_more",   snack: 5, talk: 8}  # 両方ヘビー\
]\
\
rows = cases.map do |c|\
  built = MofuDiaryBuilder.new(\
    user: user,\
    date: date,\
    debug_counts: { snack: c[:snack], talk: c[:talk] }\
  ).build\
\
  {\
    case: c[:name],\
    snack: c[:snack],\
    talk: c[:talk],\
    illust: (built.respond_to?(:illust) ? built.illust : "(no illust)"),\
    line1:  (built.respond_to?(:line1) ? built.line1 : "(no line1)"),\
    line2:  (built.respond_to?(:line2) ? built.line2 : "(no line2)")\
  }\
end\
\
rows.each do |r|\
  puts "\n[#{r[:case]}] snack=#{r[:snack]} talk=#{r[:talk]}"\
  puts "  illust: #{r[:illust]}"\
  puts "  line1 : #{r[:line1]}"\
  puts "  line2 : #{r[:line2]}"\
end\
\
nil
exit
user  = User.last\
date  = Time.zone.today\
\
cases = [\
  {name: "rest",              snack: 0, talk: 0},\
  {name: "snack_only_1",      snack: 1, talk: 0},\
  {name: "snack_only_2",      snack: 2, talk: 0},\
  {name: "snack_only_3",      snack: 3, talk: 0},\
  {name: "talk_only_1",       snack: 0, talk: 1},\
  {name: "talk_only_4",       snack: 0, talk: 4},\
  {name: "talk_only_5",       snack: 0, talk: 5},\
  {name: "both_light_min",    snack: 1, talk: 1}, # 両方ライト（最低条件）\
  {name: "both_light_max",    snack: 2, talk: 4}, # 両方ライト（上限側）\
  {name: "both_heavy_edge",   snack: 3, talk: 5}, # 両方ヘビーの境界\
  {name: "both_heavy_more",   snack: 5, talk: 8}  # 両方ヘビー\
]\
\
rows = cases.map do |c|\
  built = MofuDiaryBuilder.new(\
    user: user,\
    date: date,\
    debug_counts: { snack: c[:snack], talk: c[:talk] }\
  ).build\
\
  {\
    case: c[:name],\
    snack: c[:snack],\
    talk: c[:talk],\
    illust: (built.respond_to?(:illust) ? built.illust : "(no illust)"),\
    line1:  (built.respond_to?(:line1) ? built.line1 : "(no line1)"),\
    line2:  (built.respond_to?(:line2) ? built.line2 : "(no line2)")\
  }\
end\
\
rows.each do |r|\
  puts "\n[#{r[:case]}] snack=#{r[:snack]} talk=#{r[:talk]}"\
  puts "  illust: #{r[:illust]}"\
  puts "  line1 : #{r[:line1]}"\
  puts "  line2 : #{r[:line2]}"\
end\
\
nil
user = User.last\
today = Time.zone.today\
user.mofu_diaries.where(date: today).destroy_all
exit
MofuDiary.find(10).destroy
user = User.find(6)\
\
today = Time.zone.today\
range = today.all_day\
\
user.interactions.where(created_at: range).destroy_all
ofuDiary.find(11).destroy
MofuDiary.find(11).destroy
MofuDiary.find(12).destroy
MofuDiary.find(13).destroy
user = User.last\
today = Time.zone.today\
range = today.all_day\
\
user.interactions.where(happened_at: range).pluck(:kind)
Interaction.last(10).map { |i| [i.kind, i.happened_at] }
exit
Interaction.last(10).map { |i| [i.kind, i.happened_at] }
exit
Interaction.kinds
exit
Interaction.last(10).map { |i| [i.kind, i.happened_at] }
Interaction.last(10).map { |i| [i.kind, i.happened_at] }
exit
Interaction.last(10).map { |i| [i.kind, i.happened_at] }
Interaction.last(10).map { |i| [i.kind, i.happened_at] }
user.interactions.where(happened_at: range).group(:kind).count\
# => {} になればOK\
user.interactions.where(happened_at: range).group(:kind).count
user.interactions.where(happened_at: range).group(:kind).count
uid = "06026465-da2d-4fbf-8d69-16a3270db380"\
user = User.find_by!(guest_uid: uid)
today = Time.zone.today\
range = today.beginning_of_day..today.end_of_day
user.interactions.where(happened_at: range).destroy_all
user.mofu_diaries.where(date: today).destroy_all
user.interactions.where(happened_at: range).group(:kind).count
uid = "06026465-da2d-4fbf-8d69-16a3270db380"\
user = User.find_by!(guest_uid: uid)\
today = Time.zone.today\
range = today.beginning_of_day..today.end_of_day\
\
p user.interactions.where(happened_at: range).group(:kind).count\
p user.mofu_diaries.find_by(date: today)&.illust
user.mofu_diaries.where(date: today).destroy_all
user.mofu_diaries.where(date: today).destroy_all
user.mofu_diaries.where(date: today).destroy_all
user.mofu_diaries.where(date: today).destroy_all
exit
today = Time.zone.today\
current_user.mofu_diaries.where(date: today).destroy_all
u = User.first
today = Time.zone.today\
u.mofu_diaries.where(date: today).destroy_all
u.mofu_diaries.last.weather_slot
MofuDiary.find(18).destroy!
MofuDiary.find(19).destroy!
MofuDiary.find(20).destroy!
exit
